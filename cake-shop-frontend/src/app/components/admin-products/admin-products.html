<div class="pos-container">
  <!-- Header Section with Actions -->
  <div class="pos-header">
    <div class="pos-header-left">
      <div class="pos-title-wrapper">
        <i class="fas fa-boxes pos-title-icon"></i>
        <div>
          <h1 class="pos-title">Product Management</h1>
          <p class="pos-subtitle">Manage inventory and stock</p>
        </div>
      </div>
    </div>
    
    <div class="pos-header-right">
      <button class="pos-btn pos-btn-primary" (click)="openAddModal()" title="Ctrl+A">
        <i class="fas fa-plus"></i>
        <span>Add Product</span>
        <span class="pos-shortcut">Ctrl+A</span>
      </button>
      
      <button class="pos-btn pos-btn-export" (click)="exportCSV()" title="Ctrl+E">
        <i class="fas fa-file-csv"></i>
        <span>Export</span>
        <span class="pos-shortcut">Ctrl+E</span>
      </button>
      
      <button class="pos-btn pos-btn-reports" (click)="goToReports()" title="Ctrl+R">
        <i class="fas fa-chart-line"></i>
        <span>Reports</span>
        <span class="pos-shortcut">Ctrl+R</span>
      </button>
      
      <button class="pos-btn pos-btn-billing" (click)="goToBilling()" title="F1">
        <i class="fas fa-cash-register"></i>
        <span>Billing</span>
        <span class="pos-shortcut">F2</span>
      </button>
    </div>
  </div>

  <!-- Message Alert -->
  <div class="pos-alert-container" *ngIf="message">
    <div class="pos-alert" [class.pos-alert-success]="messageType==='success'" [class.pos-alert-error]="messageType==='error'">
      <i class="fas" [class.fa-check-circle]="messageType==='success'" [class.fa-exclamation-circle]="messageType==='error'"></i>
      <span>{{ message }}</span>
      <button class="pos-alert-close" (click)="message = ''">&times;</button>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="pos-search-section">
    <div class="pos-search-wrapper">
      <i class="fas fa-search pos-search-icon"></i>
      <input 
        type="text" 
        class="pos-search-input" 
        placeholder="Search by name or barcode..." 
        [(ngModel)]="searchTerm" 
        (input)="filterProducts()"
      >
    </div>
    
    <div class="pos-filter-group">
      <select class="pos-filter-select" [(ngModel)]="filterType" (change)="filterProducts()">
        <option value="">All Types</option>
        <option value="fixed">Fixed Price</option>
        <option value="weight">Weight Based</option>
      </select>
      
      <button class="pos-btn pos-btn-reset" (click)="resetFilters()">
        <i class="fas fa-redo"></i>
        Reset
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="pos-stats-grid">
    <div class="pos-stat-card pos-stat-primary">
      <div class="pos-stat-icon">
        <i class="fas fa-box"></i>
      </div>
      <div class="pos-stat-content">
        <div class="pos-stat-value">{{ productList.length }}</div>
        <div class="pos-stat-label">Total Products</div>
      </div>
    </div>
    
    <div class="pos-stat-card pos-stat-success">
      <div class="pos-stat-icon">
        <i class="fas fa-dollar-sign"></i>
      </div>
      <div class="pos-stat-content">
        <div class="pos-stat-value">{{ totalStockValue | number:'1.0-0' }}</div>
        <div class="pos-stat-label">Stock Value (LKR)</div>
      </div>
    </div>
    
    <div class="pos-stat-card pos-stat-warning">
      <div class="pos-stat-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <div class="pos-stat-content">
        <div class="pos-stat-value">{{ getLowStockCount() }}</div>
        <div class="pos-stat-label">Low Stock Items</div>
      </div>
    </div>
    
    <div class="pos-stat-card pos-stat-info">
      <div class="pos-stat-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="pos-stat-content">
        <div class="pos-stat-value">{{ getInStockCount() }}</div>
        <div class="pos-stat-label">In Stock</div>
      </div>
    </div>
  </div>

  <!-- Products Table -->
  <div class="pos-table-wrapper">
    <div class="pos-table-header">
      <h2 class="pos-table-title">
        <i class="fas fa-list"></i>
        Product List
      </h2>
      <span class="pos-table-count">{{ filteredProductList.length }} items</span>
    </div>
    
    <div class="pos-table-container">
      <table class="pos-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Barcode</th>
            <th>Product Name</th>
            <th>Type</th>
            <th>Price</th>
            <th>Price/Kg</th>
            <th>Stock</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of filteredProductList" class="pos-table-row">
            <td class="pos-cell-id">{{ p.id }}</td>
            <td class="pos-cell-barcode">{{ p.barcode }}</td>
            <td class="pos-cell-name">{{ p.name }}</td>
            <td>
              <span class="pos-badge" [class.pos-badge-fixed]="p.type==='fixed'" [class.pos-badge-weight]="p.type==='weight'">
                <i class="fas" [class.fa-tag]="p.type==='fixed'" [class.fa-weight]="p.type==='weight'"></i>
                {{ p.type === 'fixed' ? 'Fixed' : 'Weight' }}
              </span>
            </td>
            <td class="pos-cell-price">{{ p.price ?? '-' }}</td>
            <td class="pos-cell-price">{{ p.pricePerKg ?? '-' }}</td>
            <td class="pos-cell-stock">{{ p.stockQty }}</td>
            <td>
              <span class="pos-stock-badge" 
                    [class.pos-stock-low]="p.stockQty < 10"
                    [class.pos-stock-medium]="p.stockQty >= 10 && p.stockQty < 50"
                    [class.pos-stock-high]="p.stockQty >= 50">
                <i class="fas fa-circle"></i>
                {{ getStockStatus(p.stockQty) }}
              </span>
            </td>
            <td class="pos-cell-actions">
              <button class="pos-action-btn pos-btn-edit" (click)="openEditModal(p)" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="pos-action-btn pos-btn-delete" (click)="deleteProduct(p.id)" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="filteredProductList.length === 0">
            <td colspan="9" class="pos-no-data">
              <i class="fas fa-inbox"></i>
              <p>No products found</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div class="pos-modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="pos-modal" (click)="$event.stopPropagation()">
      <div class="pos-modal-header">
        <h2 class="pos-modal-title">
          <i class="fas" [class.fa-edit]="isEditMode" [class.fa-plus]="!isEditMode"></i>
          {{ isEditMode ? 'Edit Product' : 'Add Product' }}
        </h2>
        <button class="pos-modal-close" (click)="closeModal()">&times;</button>
      </div>

      <div class="pos-modal-body">
        <div class="pos-form-row">
          <div class="pos-form-group">
            <label class="pos-form-label">
              <i class="fas fa-barcode"></i>
              Barcode
            </label>
            <input 
              type="text" 
              class="pos-form-input" 
              [(ngModel)]="selectedProduct.barcode" 
              placeholder="Enter barcode"
            >
          </div>

          <div class="pos-form-group">
            <label class="pos-form-label">
              <i class="fas fa-box"></i>
              Product Name
            </label>
            <input 
              type="text" 
              class="pos-form-input" 
              [(ngModel)]="selectedProduct.name" 
              placeholder="Enter product name"
            >
          </div>
        </div>

        <div class="pos-form-group">
          <label class="pos-form-label">
            <i class="fas fa-tags"></i>
            Product Type
          </label>
          <select class="pos-form-select" [(ngModel)]="selectedProduct.type">
            <option value="fixed">Fixed Price</option>
            <option value="weight">Weight Based</option>
          </select>
        </div>

        <div class="pos-form-row">
          <div class="pos-form-group">
            <label class="pos-form-label">
              <i class="fas fa-money-bill"></i>
              Price (LKR)
            </label>
            <input 
              type="number" 
              class="pos-form-input" 
              [(ngModel)]="selectedProduct.price" 
              [disabled]="selectedProduct.type==='weight'" 
              placeholder="0.00"
            >
          </div>

          <div class="pos-form-group">
            <label class="pos-form-label">
              <i class="fas fa-balance-scale"></i>
              Price per Kg (LKR)
            </label>
            <input 
              type="number" 
              class="pos-form-input" 
              [(ngModel)]="selectedProduct.pricePerKg" 
              [disabled]="selectedProduct.type==='fixed'" 
              placeholder="0.00"
            >
          </div>
        </div>

        <div class="pos-form-group">
          <label class="pos-form-label">
            <i class="fas fa-warehouse"></i>
            Stock Quantity
          </label>
          <input 
            type="number" 
            class="pos-form-input" 
            [(ngModel)]="selectedProduct.stockQty" 
            placeholder="0"
          >
        </div>
      </div>

      <div class="pos-modal-footer">
        <button class="pos-btn pos-btn-secondary" (click)="closeModal()">
          <i class="fas fa-times"></i>
          Cancel
        </button>
        <button class="pos-btn pos-btn-primary" (click)="saveProduct()">
          <i class="fas fa-save"></i>
          {{ isEditMode ? 'Update' : 'Save' }}
        </button>
      </div>
    </div>
  </div>
</div>