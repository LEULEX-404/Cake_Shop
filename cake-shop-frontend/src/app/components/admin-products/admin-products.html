<div class="pm-wrapper">
  <!-- Header Section -->
  <div class="pm-header">
    <div class="pm-header-content">
      <h1 class="pm-title">
        <span class="pm-title-icon">üì¶</span>
        Product Management
      </h1>
      <p class="pm-subtitle">Manage your inventory and products</p>
    </div>
    <div class="pm-header-actions">
      <button class="pm-btn pm-btn-primary" (click)="openAddModal()">
        <span class="pm-btn-icon">‚ûï</span>
        Add Product
      </button>
      <button class="pm-btn pm-btn-secondary" (click)="exportCSV()">
        <span class="pm-btn-icon">üìÑ</span>
        Export CSV
      </button>
      <a routerLink="" class="pm-btn pm-btn-info">
        <span class="pm-btn-icon">üõí</span>
        Go to Billing
      </a>
    </div>
  </div>

  <!-- Message Alert -->
  <div class="pm-alert-container" *ngIf="message">
    <div class="pm-alert" [class.pm-alert-success]="messageType==='success'" [class.pm-alert-error]="messageType==='error'">
      <span class="pm-alert-icon">{{ messageType === 'success' ? '‚úì' : '‚ö†' }}</span>
      <span class="pm-alert-text">{{ message }}</span>
      <button class="pm-alert-close" (click)="message = ''">√ó</button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="pm-stats-grid">
    <div class="pm-stat-card">
      <div class="pm-stat-icon pm-stat-icon-primary">üìä</div>
      <div class="pm-stat-details">
        <p class="pm-stat-label">Total Products</p>
        <p class="pm-stat-value">{{ productList.length }}</p>
      </div>
    </div>
    
    <div class="pm-stat-card">
      <div class="pm-stat-icon pm-stat-icon-success">üí∞</div>
      <div class="pm-stat-details">
        <p class="pm-stat-label">Stock Value</p>
        <p class="pm-stat-value">{{ totalStockValue | number }} <span class="pm-currency">LKR</span></p>
      </div>
    </div>
    
    <div class="pm-stat-card">
      <div class="pm-stat-icon pm-stat-icon-warning">üì¶</div>
      <div class="pm-stat-details">
        <p class="pm-stat-label">Low Stock Items</p>
        <p class="pm-stat-value">{{ getLowStockCount() }}</p>
      </div>
    </div>
    
    <div class="pm-stat-card">
      <div class="pm-stat-icon pm-stat-icon-info">üè∑Ô∏è</div>
      <div class="pm-stat-details">
        <p class="pm-stat-label">Product Types</p>
        <p class="pm-stat-value">{{ getProductTypes() }}</p>
      </div>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="pm-table-controls">
    <div class="pm-search-box">
      <span class="pm-search-icon">üîç</span>
      <input type="text" class="pm-search-input" placeholder="Search products..." [(ngModel)]="searchTerm" (input)="filterProducts()">
    </div>
    <div class="pm-filter-group">
      <select class="pm-filter-select" [(ngModel)]="filterType" (change)="filterProducts()">
        <option value="">All Types</option>
        <option value="fixed">Fixed Price</option>
        <option value="weight">Weight Based</option>
      </select>
      <button class="pm-btn pm-btn-outline" (click)="resetFilters()">
        <span class="pm-btn-icon">üîÑ</span>
        Reset
      </button>
    </div>
  </div>

  <!-- Products Table -->
  <div class="pm-table-container">
    <table class="pm-table">
      <thead class="pm-table-head">
        <tr>
          <th class="pm-th">ID</th>
          <th class="pm-th">Barcode</th>
          <th class="pm-th">Name</th>
          <th class="pm-th">Type</th>
          <th class="pm-th">Price</th>
          <th class="pm-th">Price/Kg</th>
          <th class="pm-th">Stock Qty</th>
          <th class="pm-th">Status</th>
          <th class="pm-th">Actions</th>
        </tr>
      </thead>
<tbody class="pm-table-body">
  <tr *ngFor="let p of filteredProductList" class="pm-table-row">
    <td>{{p.id}}</td>
    <td>{{p.barcode}}</td>
    <td>{{p.name}}</td>
    <td>{{p.type}}</td>
    <td>{{p.price ?? '-'}}</td>
    <td>{{p.pricePerKg ?? '-'}}</td>
    <td>{{p.stockQty}}</td>
    <td>
      <span [class.pm-stock-low]="p.stockQty<10"
            [class.pm-stock-medium]="p.stockQty>=10 && p.stockQty<50"
            [class.pm-stock-high]="p.stockQty>=50">
        {{ getStockStatus(p.stockQty) }}
      </span>
    </td>
    <td>
      <button (click)="openEditModal(p)">Edit</button>
      <button (click)="deleteProduct(p.id)">Delete</button>
    </td>
  </tr>
</tbody>


    </table>
  </div>

  <!-- Modal -->
  <div class="pm-modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="pm-modal" (click)="$event.stopPropagation()">
      <div class="pm-modal-header">
        <h2 class="pm-modal-title">{{ isEditMode ? '‚úèÔ∏è Edit Product' : '‚ûï Add Product' }}</h2>
        <button class="pm-modal-close" (click)="closeModal()">√ó</button>
      </div>

      <div class="pm-modal-body">
        <div class="pm-form-group">
          <label class="pm-form-label">Barcode</label>
          <input type="text" class="pm-form-input" [(ngModel)]="selectedProduct.barcode" placeholder="Enter barcode">
        </div>

        <div class="pm-form-group">
          <label class="pm-form-label">Product Name</label>
          <input type="text" class="pm-form-input" [(ngModel)]="selectedProduct.name" placeholder="Enter product name">
        </div>

        <div class="pm-form-group">
          <label class="pm-form-label">Product Type</label>
          <select class="pm-form-select" [(ngModel)]="selectedProduct.type">
            <option value="fixed">Fixed Price</option>
            <option value="weight">Weight Based</option>
          </select>
        </div>

        <div class="pm-form-row">
          <div class="pm-form-group">
            <label class="pm-form-label">Price (LKR)</label>
            <input type="number" class="pm-form-input" [(ngModel)]="selectedProduct.price" [disabled]="selectedProduct.type==='weight'" placeholder="0.00">
          </div>

          <div class="pm-form-group">
            <label class="pm-form-label">Price per Kg (LKR)</label>
            <input type="number" class="pm-form-input" [(ngModel)]="selectedProduct.pricePerKg" [disabled]="selectedProduct.type==='fixed'" placeholder="0.00">
          </div>
        </div>

        <div class="pm-form-group">
          <label class="pm-form-label">Stock Quantity</label>
          <input type="number" class="pm-form-input" [(ngModel)]="selectedProduct.stockQty" placeholder="0">
        </div>
      </div>

      <div class="pm-modal-footer">
        <button class="pm-btn pm-btn-secondary" (click)="closeModal()">Cancel</button>
        <button class="pm-btn pm-btn-primary" (click)="saveProduct()">
          {{ isEditMode ? 'Update Product' : 'Add Product' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Reports Section -->
  <div class="pm-reports-section">
    <div class="pm-section-header">
      <h2 class="pm-section-title">
        <span class="pm-title-icon">üìà</span>
        Reports & Analytics
      </h2>
      <button class="pm-btn pm-btn-outline">
        <span class="pm-btn-icon">üìä</span>
        View All Reports
      </button>
    </div>

    <div class="pm-reports-grid">
      <div class="pm-report-card">
        <div class="pm-report-header">
          <h3 class="pm-report-title">Inventory Summary</h3>
          <span class="pm-report-icon">üì¶</span>
        </div>
        <div class="pm-report-content">
          <div class="pm-report-item">
            <span class="pm-report-label">Total Items:</span>
            <span class="pm-report-value">{{ productList.length }}</span>
          </div>
          <div class="pm-report-item">
            <span class="pm-report-label">In Stock:</span>
            <span class="pm-report-value">{{ getInStockCount() }}</span>
          </div>
          <div class="pm-report-item">
            <span class="pm-report-label">Out of Stock:</span>
            <span class="pm-report-value">{{ getOutOfStockCount() }}</span>
          </div>
        </div>
        <button class="pm-report-btn">View Details ‚Üí</button>
      </div>

      <div class="pm-report-card">
        <div class="pm-report-header">
          <h3 class="pm-report-title">Value Analysis</h3>
          <span class="pm-report-icon">üíµ</span>
        </div>
        <div class="pm-report-content">
          <div class="pm-report-item">
            <span class="pm-report-label">Total Value:</span>
            <span class="pm-report-value">{{ totalStockValue | number }} LKR</span>
          </div>
          <div class="pm-report-item">
            <span class="pm-report-label">Avg. Price:</span>
            <span class="pm-report-value">{{ getAveragePrice() | number }} LKR</span>
          </div>
          <div class="pm-report-item">
            <span class="pm-report-label">Highest Value:</span>
            <span class="pm-report-value">{{ getHighestValue() | number }} LKR</span>
          </div>
        </div>
        <button class="pm-report-btn">View Details ‚Üí</button>
      </div>

      <div class="pm-report-card">
        <div class="pm-report-header">
          <h3 class="pm-report-title">Product Distribution</h3>
          <span class="pm-report-icon">üéØ</span>
        </div>
        <div class="pm-report-content">
          <div class="pm-report-item">
            <span class="pm-report-label">Fixed Price:</span>
            <span class="pm-report-value">{{ getFixedPriceCount() }}</span>
          </div>
          <div class="pm-report-item">
            <span class="pm-report-label">Weight Based:</span>
            <span class="pm-report-value">{{ getWeightBasedCount() }}</span>
          </div>
          <div class="pm-report-item">
            <span class="pm-report-label">Categories:</span>
            <span class="pm-report-value">2</span>
          </div>
        </div>
        <button class="pm-report-btn">View Details ‚Üí</button>
      </div>
    </div>
  </div>
</div>